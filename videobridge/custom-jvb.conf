
videobridge {
    cc {
        use-vla-target-bitrate = true
        trust-bwe = true
        onstage-preferred-height-px = 1080
        max-oversend-bitrate = 1500 kbps
    }

    ice {
        udp {
            port = 10000
        }
        advertise-private-candidates = false
    }

    apis {
        xmpp-client {
            configs {
                shard0 {
                    HOSTNAME = "{{ .Env.XMPP_DOMAIN }}"
                    PORT = "5222"
                    DOMAIN = "auth.{{ .Env.XMPP_DOMAIN }}"
                    USERNAME = "jvb"
                    PASSWORD = "{{ .Env.JVB_AUTH_PASSWORD }}"
                    MUC_JIDS = "JvbBrewery@internal-muc.{{ .Env.XMPP_DOMAIN }}"
                    MUC_NICKNAME = "{{ .Env.JVB_MUC_NICKNAME }}"
                    DISABLE_CERTIFICATE_VERIFICATION = true
                }
            }
        }
        rest {
            enabled = true
        }
    }

    rest {
        enabled = true
        shutdown {
            enabled = true
        }
    }

    sctp {
      enabled = true
      use-usrsctp = true
    }

    stats {
        enabled = true
        transport = "muc"
        interval = 10 minutes
    }

    websockets {
        domain = "{{ .Env.XMPP_DOMAIN }}"
        server-id = "{{ .Env.JVB_INSTANCE_ID }}"
        enabled = true
        tls = true
        keep-alive-timeout = 30 seconds
    }

    http-servers {
        private {
          host = 0.0.0.0
          send-server-version = false
        }
        public {
            host = 0.0.0.0
            port = 9090
            send-server-version = false
        }
    }

    health {
        interval = 60 seconds
        timeout = 90 seconds
        require-valid-address = false
    }

    relay {
        enabled = true
        region = "{{ .Env.JVB_OCTO_REGION }}"
        relay-id = "{{ .Env.JVB_INSTANCE_ID }}"
    }

    load-management {
        reducer-enabled = true
    }
}

ice4j {
    harvest {
        mapping {
            stun {
                enabled = true
                addresses = [
                    "stun.cloudflare.com:3478", # udp
                    "stun.cloudflare.com:53" # udp
                ]
            }
            static-mappings = [
                {
                    local-address = "{{ .Env.LOCAL_ADDRESS }}"
                    public-address = "{{ .Env.JVB_ADVERTISE_IPS }}"
                    name = "ip-mapping"
                }
            ]
        }
        # Disable AWS harvester
        use-component-socket = true
    }
}

jmt {
  bwe {
    estimator {
      engine = GoogleCc2
      max-bw = 100 mbps
    }
  }
  audio {
    red {
      policy = PROTECT_ALL
    }
  }
}
